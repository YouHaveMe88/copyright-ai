<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>AI News Rewriter & Summarizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="/static/styles.css">
  <style>
    /* Tambahan gaya untuk tombol copy */
    .copy-btn {
      background-color: var(--accent);
      color: #000;
      border: none;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      transition: all .2s ease;
      font-weight: bold;
      margin-top: 10px;
    }
    .copy-btn:hover {
      background-color: #00c27a;
    }
    #copyNotice {
      color: var(--accent);
      margin-top: 5px;
      font-size: 0.9em;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üì∞ AI News Rewriter & Summarizer</h1>
    <p>Masukkan URL atau teks berita untuk diringkas, ditulis ulang, dibuatkan judul, atau tagar.</p>

    <input type="text" id="urlInput" placeholder="Masukkan URL berita (opsional)">
    <textarea id="textInput" rows="7" placeholder="Atau tempelkan teks berita di sini..."></textarea>

    <div class="mode-group">
      <select id="actionSelect">
        <option value="summarize">Ringkas Berita</option>
        <option value="rewrite">Tulis Ulang (Anti-Copyright)</option>
      </select>

      <select id="modeSelect">
        <option value="AI">Gunakan AI</option>
        <option value="Lokal">Gunakan Mode Lokal</option>
      </select>
    </div>

    <div class="btn-group">
      <button id="processBtn">Proses</button>
      <button id="titleBtn">Generate Judul</button>
      <button id="hashtagBtn">Generate Tagar</button>
    </div>

    <label style="display:flex;align-items:center;gap:6px;margin-top:8px;">
      <input type="checkbox" id="includeGlobal" checked>
      Sertakan Tagar Global üåç
    </label>

    <a href="/schedule" style="color:#00f5a0;font-weight:bold;text-decoration:none;">üîî Lihat Jadwal FYP AI</a>

    <div id="result"></div>
    <button id="copyBtn" class="copy-btn" style="display:none;">üìã Copy Hasil</button>
    <div id="copyNotice">‚úÖ Teks berhasil disalin!</div>
  </div>

  <script>
  // === üîß Formatter hasil AI agar rapi ===
  function formatAIText(text) {
    if (!text) return "";
    return (
      text
        // ubah **bold**
        .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
        // ubah *italic*
        .replace(/\*(.*?)\*/g, "<em>$1</em>")
        // ubah list "-"
        .replace(/^- (.*$)/gim, "<li>$1</li>")
        // ubah dua newline jadi paragraf baru
        .replace(/\n{2,}/g, "</p><p>")
        // ubah satu newline jadi <br>
        .replace(/\n/g, "<br>")
        // bungkus list otomatis jadi ul
        .replace(/(<li>[\s\S]*?<\/li>)/gim, "<ul>$1</ul>")
    );
  }

  // === Tombol utama ===
  document.getElementById("hashtagBtn").onclick = () => {
    const includeGlobal = document.getElementById("includeGlobal").checked;
    sendRequest("generate_hashtags", includeGlobal);
  };

  async function sendRequest(action, includeGlobal = true) {
    const url = document.getElementById("urlInput").value;
    const text = document.getElementById("textInput").value;
    const mode = document.getElementById("modeSelect").value;

    const resultBox = document.getElementById("result");
    const copyBtn = document.getElementById("copyBtn");
    const notice = document.getElementById("copyNotice");

    resultBox.innerHTML = "<i>‚è≥ Memproses...</i>";
    copyBtn.style.display = "none";
    notice.style.display = "none";

    const res = await fetch("/process", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ url, text, mode, action, include_global: includeGlobal })
    });

    const data = await res.json();
    const clean = data.result || data.error;

    // ‚ú® Format hasil agar tampil rapi
    resultBox.innerHTML = `<div>${formatAIText(clean)}</div>`;

    // tampilkan tombol copy bila ada hasil
    if (data.result) copyBtn.style.display = "inline-block";
  }

  document.getElementById("processBtn").onclick = () =>
    sendRequest(document.getElementById("actionSelect").value);
  document.getElementById("titleBtn").onclick = () => sendRequest("generate_title");
  document.getElementById("hashtagBtn").onclick = () => sendRequest("generate_hashtags");

  // === Copy hasil tanpa HTML tag ===
  document.getElementById("copyBtn").onclick = async () => {
    const temp = document.createElement("div");
    temp.innerHTML = document.getElementById("result").innerHTML;
    const plain = temp.innerText.trim();
    await navigator.clipboard.writeText(plain);

    const notice = document.getElementById("copyNotice");
    notice.style.display = "block";
    setTimeout(() => (notice.style.display = "none"), 2000);
  };
</script>
</body>
</html>
